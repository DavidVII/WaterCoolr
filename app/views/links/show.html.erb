<div class="entry">
<h4 class="title"><%= link_to @link.title, @link.url, { target: "_blank" } %></h4>
<p>Posted <%= time_ago_in_words(@link.created_at) %> ago by <%= @link.user.username %></p>
<% if current_user && current_user.votes.where(link_id: @link.id, up: true).present? %>
  <div class="voting">
    <i class="icon-thumbs-up active"></i>
    <p><%= @link.votes.where(up: true).count - @link.votes.where(up: false).count %></p>
    <%= link_to "", votes_path( vote: { link_id: @link.id, up: false }), class: "icon-thumbs-down", method: :post %>
  </div>
<% elsif current_user && current_user.votes.where(link_id: @link.id, up: false).present? %>
  <div class="voting">
    <%= link_to "", votes_path( vote: { link_id: @link.id, up: true } ), class: "icon-thumbs-up", method: :post %>
    <p><%= @link.votes.where(up: true).count - @link.votes.where(up: false).count %></p>
    <i class="icon-thumbs-down active"></i>
  </div>
<% else %>
  <div class="voting">
    <%= link_to "", votes_path( vote: { link_id: @link.id, up: true } ), class: "icon-thumbs-up", method: :post %>
    <p><%= @link.votes.where(up: true).count - @link.votes.where(up: false).count %></p>
    <%= link_to "", votes_path( vote: { link_id: @link.id, up: false }), class: "icon-thumbs-down", method: :post %>
  </div>
<% end %>
</div>

<% if @link.comments.present? %>
  <h4 class="title"><%= pluralize(@link.comments.count, "Comment") %></h4>
<% else %>
  <h4 class="title">No comments yet...</h4>
<% end %>


<% if current_user.present? %>
  <%= render 'layouts/comment_form' %>
<% else %>
  <p><%= link_to 'Sign in', new_user_session_path %> to leave a comment.</p>
<% end %>

<div class="comments">
  <% @linkComments.each do |comment| %>
    <div>
      <p><%= comment.message %></p>
      <p><small>Posted by <%= comment.user.username %> <%= time_ago_in_words(comment.created_at) %> ago.</small></p>
    </div>
  <% end %>
</div>
